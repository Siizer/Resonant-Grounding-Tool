<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Resonant Grounding Calculator (Educational)</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    label { display: block; margin: 6px 0; }
    input, select { margin-left: 10px; }
    svg text { font-size: 12px; }
    h1, h2 { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>üåê Resonant Grounding Calculator & Educational Tool</h1>
  <p>This tool helps determine the correct neutral grounding reactor value for arc suppression via resonant grounding. It assumes a single 3-phase overhead or underground line and uses system capacitance to compute the required neutral inductance.</p>
  <p><strong>Note:</strong> Series line inductance is intentionally omitted. In resonant grounding, the zero-sequence current path involves shunt capacitance to ground‚Äînot the line's series impedance.</p>

  <label>Total Line Length (3-phase, km): <input id="L_total" type="number" value="30"></label>
  <label>Capacitance per km per phase (nF/km): <input id="C_per_km" type="number" step="0.01" value="0.2"></label>
  <label>System Frequency (Hz): <input id="freq" type="number" value="50"></label>
  <label>Damping (% of X<sub>L</sub>): <input id="damping" type="number" step="1" value="5"></label>
  <label>Connection Type:
    <select id="connection">
      <option value="parallel">R ‚Äñ L (Parallel)</option>
      <option value="series">R + L (Series)</option>
    </select>
  </label>

  <button onclick="calculate()">Calculate</button>

  <p><strong>Total zero-sequence capacitance:</strong> <span id="cap"></span> ¬µF</p>
  <p><strong>Required neutral grounding inductance:</strong> <span id="ind"></span> mH</p>
  <p><strong>Recommended damping resistor:</strong> <span id="res"></span> Œ©</p>

  <svg id="diagram" width="700" height="320"></svg>

  <script>
    const svg = d3.select("#diagram");

    svg.append("text").attr("x", 10).attr("y", 15).text("Schematic of Single-Line to Ground Fault Path (for Resonant Grounding)");

    svg.append("line").attr("x1", 80).attr("y1", 40).attr("x2", 220).attr("y2", 40).attr("stroke", "black");
    svg.append("text").attr("x", 30).attr("y", 45).text("3-phase line");
    svg.append("line").attr("x1", 220).attr("y1", 40).attr("x2", 220).attr("y2", 140).attr("stroke", "gray").attr("stroke-dasharray", "4");
    svg.append("circle").attr("cx", 220).attr("cy", 140).attr("r", 5).attr("fill", "black");
    svg.append("text").attr("x", 230).attr("y", 145).text("Neutral (N)");

    svg.append("line").attr("x1", 220).attr("y1", 140).attr("x2", 320).attr("y2", 140).attr("stroke", "black");
    svg.append("rect").attr("x", 320).attr("y", 125).attr("width", 20).attr("height", 30).attr("fill", "#ccc");
    svg.append("line").attr("x1", 340).attr("y1", 140).attr("x2", 390).attr("y2", 140).attr("stroke", "black");
    svg.append("rect").attr("x", 390).attr("y", 130).attr("width", 10).attr("height", 20).attr("fill", "red");
    svg.append("line").attr("x1", 400).attr("y1", 140).attr("x2", 460).attr("y2", 140).attr("stroke", "black");
    svg.append("line").attr("x1", 460).attr("y1", 140).attr("x2", 460).attr("y2", 180).attr("stroke", "black");
    svg.append("line").attr("x1", 220).attr("y1", 180).attr("x2", 460).attr("y2", 180).attr("stroke", "black");
    svg.append("text").attr("x", 250).attr("y", 175).text("Ground path");

    const textL = svg.append("text").attr("x", 325).attr("y", 120).attr("id", "Lval");
    const textR = svg.append("text").attr("x", 395).attr("y", 125).attr("id", "Rval");

    function calculate() {
      const L_km = parseFloat(document.getElementById("L_total").value);
      const C_km = parseFloat(document.getElementById("C_per_km").value) * 1e-9;
      const freq = parseFloat(document.getElementById("freq").value);
      const dampPct = parseFloat(document.getElementById("damping").value) / 100;
      const connType = document.getElementById("connection").value;

      const w = 2 * Math.PI * freq;
      const C_total = 3 * L_km * C_km;
      const L = 1 / (w * w * C_total);
      const XL = w * L;

      let R;
      if (connType === "parallel") {
        R = XL / dampPct;  // Parallel damping: R = XL / damping
      } else {
        R = dampPct * XL;  // Series damping: R = damping √ó XL
      }

      document.getElementById("cap").innerText = (C_total * 1e6).toFixed(3);
      document.getElementById("ind").innerText = (L * 1e3).toFixed(3);
      document.getElementById("res").innerText = R.toFixed(2);

      textL.text("L = " + (L * 1e3).toFixed(1) + " mH");
      textR.text("R = " + R.toFixed(1) + " Œ© (" + (connType === "parallel" ? "‚Äñ" : "+") + " L)");
    }
  </script>
</body>
</html>
